const isInStandaloneMode=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone||document.referrer.includes("android-app://"),$=document.querySelector.bind(document),$$=document.querySelectorAll.bind(document);function ajax(e,t,n,o){t="function"==typeof t?(a=t,n||1e4):(i=t,a=n,o||1e4),new Date;var i,a,s=new XMLHttpRequest;if(s.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var t;try{t=JSON.parse(this.response)}catch(e){t=this.response}a(t),s=null}else 4==this.readyState&&a({error:"failure"})},s.ontimeout=function(e){a({error:"timeout"})},i){if(!(i instanceof FormData)){var r,c=new FormData;for(r in i)c.append(r,i[r]);i=c}s.open("POST",e,!0),s.timeout=t,s.send(i)}else s.open("GET",e,!0),s.timeout=t,s.send();return s}function popup(e,t,o){var i=document.getElementById("popup-reusable"),a=(o=o||[],i.querySelector(".content h2").innerHTML=e,i.querySelector(".content p").innerHTML=t,i.querySelector(".buttons"));a.innerHTML="",Object.keys(o).forEach(function(e,t){var n=document.createElement("button");n.className="link-button",n.innerHTML=e,n.addEventListener("click",function(){if("string"==typeof o[e])return"hide"==o[e]?i.hide():window.location.href=o[e];o[e].call(i)}),a.appendChild(n)}),i.show()}!function(){function t(t){(t=t||this).classList.contains("checkbox")&&(t.addEventListener("click",function(e){e.target.classList.contains("checkbox")&&!e.target.classList.contains("disabled")&&n(e.target),t.dispatchEvent(new CustomEvent("change"))}),t.toggleCheckbox=n,t.getValue=e,t.setValue=o)}function n(e){(e=e||this).classList.contains("checked")?(e.classList.remove("checked"),e.isChecked=!1,e.querySelector('input[type="hidden"]').value=0):(e.classList.add("checked"),e.isChecked=!0,e.querySelector('input[type="hidden"]').value=1)}function e(){return"1"==this.querySelector('input[type="hidden"]').value}function o(e){e="1"==e||"true"==e||1==e;e?(this.classList.add("checked"),this.isChecked=!0,this.querySelector('input[type="hidden"]').value=1):(this.classList.remove("checked"),this.isChecked=!1,this.querySelector('input[type="hidden"]').value=0)}HTMLElement.prototype.initCheckbox=t,document.querySelectorAll(".checkbox").forEach(e=>t(e))}(),function(){function t(t){(t=t||this).classList.contains("textbox")&&(t.getValue=e,t.setValue=n,t.parentElement.querySelector(".edit-warning")&&t.addEventListener("keyup",e=>{t.parentElement.querySelector(".edit-warning").classList.add("visible")}),t.addEventListener("keyup",e=>{clearTimeout(t.changeTimer),t.changeTimer=setTimeout(function(){t.dispatchEvent(new CustomEvent("change"))},1e3)}),t.parentElement?.querySelector("button.clear-input")?.addEventListener("click",e=>{t.setValue(""),t.dispatchEvent(new CustomEvent("change"))}))}function e(){return this.value}function n(e){this.value=e,this.dispatchEvent(new CustomEvent("input"))}HTMLElement.prototype.inittextbox=t,document.querySelectorAll(".textbox").forEach(e=>t(e))}(),function(){function t(n){(n=n||this).classList.contains("radioblock")&&(n.getValue=e,n.setValue=o,n.clear=i,n.addEventListener("click",e=>{var t;return e.target==n&&n.classList.contains("disabled")||(t=e.target.closest(".radioblock"))&&t.classList.contains("disabled")?e.preventDefault():void(e.target==n&&n.dispatchEvent(new CustomEvent("change"),{bubbles:!0}))}))}function e(){var e=this.querySelector('input[type="radio"]:checked');return e?e.value:""}function o(t){var e=this.querySelectorAll('input[type="radio"]'),e=(e=Array.prototype.slice.call(e)).find(e=>e.value==t);e&&(e.checked=!0)}function i(){var e=this.querySelector('input[type="radio"]:checked');e&&(e.checked=!1)}HTMLElement.prototype.initradioblock=t,document.querySelectorAll(".radioblock").forEach(e=>t(e))}(),function(){function t(e){(e=e||this).closest(".comment-form")&&e.closest(".comment-form").dataset.login||new o(e)}const n="\x3c!--htmlmode--\x3e";class o{constructor(e){this.editor=e,this.contentArea=e.querySelector(".content-area"),this.addLinkPopup=e.querySelector(".popup.link"),this.addImagePopup=e.querySelector(".popup.image"),this.editLinkPopup=e.querySelector(".popup.link-edit"),this.htmlModeLink=e.querySelector(".htmlModeLink"),this.htmlEditor=e.querySelector("#text-htmleditor"),this.currentSelection=null,this.emojiPopup=this.editor.querySelector(".emoji-popup"),this.emojiMenu=this.editor.querySelector(".emoji-menu"),this.emojiList=this.editor.querySelector(".emoji-selected-set"),this.emojiSetMenu=this.emojiMenu.querySelector(".emoji-sets"),this.emojiSetShadows=this.emojiMenu.querySelector(".emoji-set-shadows"),this.exportField=e.querySelector(".export"),this.exportTimer=null,this.htmlMode=!1,e.classList.contains("disabled")||(this.editorButton={bold:()=>{document.execCommand("bold",!1,""),this.export()},italic:()=>{document.execCommand("italic",!1,""),this.export()},underline:()=>{document.execCommand("underline",!1,""),this.export()},strikethrough:()=>{document.execCommand("strikeThrough",!1,""),this.export()},h2:()=>{document.execCommand("formatBlock",!1,"h2"),this.export()},h3:()=>{document.execCommand("formatBlock",!1,"h3"),this.export()},link:function(){var e=this.addLinkPopup;e.querySelector("#text-text").value=this.getSelectionText()||"",e.querySelector("#text-url").value="",this.saveSelection(),e.show()},image:function(){var e=this.addImagePopup;e.querySelector("#text-url").value="",this.saveSelection(),e.show()},emoji:()=>{this.saveSelection(),this.emojiSetMenu.children[0].click(),this.emojiPopup.show()}},document.execCommand("defaultParagraphSeparator",!1,"p"),e.querySelectorAll(".toolbar>button").forEach(e=>{this.editorButton.hasOwnProperty(e.dataset.action)&&e.addEventListener("click",this.editorButton[e.dataset.action].bind(this))}),this.addLinkPopup.querySelector(".button-insert").addEventListener("click",this.addLink.bind(this)),this.addLinkPopup.querySelector(".button-cancel").addEventListener("click",this.addLinkPopup.hide),this.editLinkPopup.querySelector(".button-save").addEventListener("click",this.saveLink.bind(this)),this.editLinkPopup.querySelector(".button-cancel").addEventListener("click",this.editLinkPopup.hide),this.addImagePopup.querySelector(".button-insert").addEventListener("click",this.addImage.bind(this)),this.addImagePopup.querySelector(".button-cancel").addEventListener("click",this.addImagePopup.hide),this.contentArea.addEventListener("click",this.editorClick.bind(this)),this.contentArea.addEventListener("copy",e=>{var t=e.clipboardData||window.clipboardData,n=document.getSelection(),t=(t.setData("lospec-editor","true"),n.getRangeAt(0)),n=document.createElement("div"),t=(n.appendChild(t.cloneContents()),n.innerHTML);event.clipboardData.setData("text/html",t),e.preventDefault()}),this.contentArea.addEventListener("paste",e=>{var t=e.clipboardData||window.clipboardData;t.getData("lospec-editor")||(document.execCommand("insertText",!1,t.getData("text")),e.preventDefault()),this.export()}),this.emojiSetMenu.addEventListener("wheel",e=>{var t=0<e.deltaY?1:e.deltaY<0?-1:0;this.emojiSetMenu.scrollBy(10*t,0),this.emojiSetShadows.className="emoji-set-shadows",this.emojiSetMenu.scrollLeft<=0?this.emojiSetShadows.classList.add("left"):this.emojiSetMenu.scrollLeft>=this.emojiSetMenu.scrollWidth-this.emojiSetMenu.offsetWidth&&this.emojiSetShadows.classList.add("right"),e.preventDefault()}),this.emojiSetMenu.dispatchEvent(new CustomEvent("wheel",{deltaY:0})),this.emojiSetMenu.addEventListener("click",e=>{var t=e.target;(t="LI"==t.tagName?t.children[0]:t).classList.contains("emoji")&&!t.classList.contains("selected")&&ajax("/emoji/editor/"+t.dataset.set,e=>{e.success&&(this.emojiList.innerHTML=e.html,this.emojiSetMenu.querySelector(".selected")&&this.emojiSetMenu.querySelector(".selected").classList.remove("selected"),t.classList.add("selected"))})}),this.emojiList.addEventListener("click",e=>{var e=e.target;(e="LI"==e.tagName?e.children[0]:e).classList.contains("emoji")&&(this.restoreSelection(),e=e.cloneNode(!0),document.execCommand("insertHTML",!1,e.outerHTML+"&nbsp"),this.emojiPopup.hide(),this.export())}),e.addEventListener("keyup",this.export.bind(this)),this.contentArea.addEventListener("blur",()=>{this.export.bind(this)(!0)}),this.contentArea.addEventListener("keydown",e=>{if(39!=e.keyCode&&13==e.keyCode&&this.editor.dataset.blocklinebreaks)return e.preventDefault()}),this.htmlModeLink&&(this.htmlEditor.addEventListener("blur",()=>{this.export.bind(this)(!0)}),this.htmlModeLink.addEventListener("click",e=>{this.htmlMode?(this.htmlModeLink.innerHTML="Switch to HTML editor",this.editor.classList.remove("htmlMode"),this.htmlMode=!1):(this.htmlModeLink.innerHTML="Switch to text editor",this.htmlEditor.value=this.contentArea.innerHTML.substr(n.length),this.editor.classList.add("htmlMode"),this.htmlMode=!0)}),this.contentArea.innerHTML.startsWith(n))&&this.htmlModeLink.click())}addLink(){var e=this.addLinkPopup.querySelector("#text-url").value,t=this.addLinkPopup.querySelector("#text-text").value;/^(http:\/\/|https:\/\/)/.test(e)?(this.restoreSelection(),e='<a href="'+e+'" target="_blank">'+(t=t.length<1?e:t)+"</a>",this.contentArea.focus(),document.execCommand("insertHTML",!1,e),this.contentArea.appendChild(document.createTextNode("")),this.addLinkPopup.hide(),this.export()):(this.addLinkPopup.querySelector(".error").innerHTML="Url doesn't look right",this.addLinkPopup.querySelector(".error").classList.remove("anim-errorshake"),setTimeout(()=>{this.addLinkPopup.querySelector(".error").classList.add("anim-errorshake")},10))}addImage(){this.restoreSelection();var e='<img class="inline-image" src="'+this.addImagePopup.querySelector("#text-url").value+'" />';this.contentArea.focus(),document.execCommand("insertHTML",!1,e),this.addImagePopup.hide(),this.export()}editorClick(e){var t;"A"==e.target.tagName?e.target.classList.contains("selected")||(this.hideLinkTools(),e.target.classList.add("selected"),(t=this.editor.querySelector(".link-tools").cloneNode(!0)).classList.remove("template"),t=e.target.appendChild(t),setTimeout(()=>{t.classList.add("shown")},10),t.querySelector(".edit").addEventListener("click",this.editLink.bind(this)),t.querySelector(".delete").addEventListener("click",this.removeLink.bind(this))):(this.contentArea.querySelectorAll(".link-tools").forEach(e=>e.parentNode.removeChild(e)),this.contentArea.querySelectorAll("a.selected").forEach(e=>e.classList.remove("selected")))}hideLinkTools(){this.contentArea.querySelectorAll(".link-tools").forEach(e=>e.parentNode.removeChild(e)),this.contentArea.querySelectorAll("a.selected").forEach(e=>e.classList.remove("selected"))}editLink(e){var t=this.contentArea.querySelector("a.selected"),n=this.editLinkPopup;n.querySelector("#text-url").value=t.href,n.querySelector("#text-text").value=t.innerText,n.show(),e.stopPropagation()}removeLink(e){var t=this.editor.querySelector("a.selected");t.outerHTML=t.innerText,e.stopPropagation(),this.export()}saveLink(){var e=this.editor.querySelector("a.selected");e.href=this.editLinkPopup.querySelector("#text-url").value,e.innerHTML=this.editLinkPopup.querySelector("#text-text").value,this.contentArea.querySelectorAll("a.selected").forEach(e=>e.classList.remove("selected")),this.editLinkPopup.hide(),this.export()}saveSelection(){var e,t;window.getSelection?(t=window.getSelection()).getRangeAt&&t.rangeCount&&(e=t.getRangeAt(0)):e=document.selection&&document.selection.createRange?document.selection.createRange():null,this.currentSelection=e}restoreSelection(){var e,t=this.currentSelection;t&&(window.getSelection?((e=window.getSelection()).removeAllRanges(),e.addRange(t)):document.selection&&t.select&&t.select())}getCaretPosition(){var e,t,n=this.contentArea,o=0;return window.getSelection?(e=window.getSelection()).rangeCount&&(t=e.getRangeAt(0)).commonAncestorContainer.parentNode==n&&(o=t.endOffset):document.selection&&document.selection.createRange&&(t=document.selection.createRange()).parentElement()==n&&(e=document.createElement("span"),n.insertBefore(e,n.firstChild),(n=t.duplicate()).moveToElementText(e),n.setEndPoint("EndToEnd",t),o=n.text.length),o}getSelectionText(){var e="";return window.getSelection?e=window.getSelection().toString():document.selection&&"Control"!=document.selection.type&&(e=document.selection.createRange().text),e}export(e){e=1==e?0:500;clearTimeout(this.exportTimer),this.exportTimer=setTimeout(()=>{(this.htmlMode?(this.exportField.value=n+this.htmlEditor.value,this.htmlEditor):(this.exportField.value=this.contentArea.innerHTML,this.contentArea)).dispatchEvent(new CustomEvent("export"))},e)}}HTMLElement.prototype.initCheckbox=t,window.addEventListener("load",()=>document.querySelectorAll(".editor").forEach(e=>t(e)))}(),function(){function t(e){e.getValue=function(){return this.value}}HTMLElement.prototype.initauthor=t,document.querySelectorAll(".author").forEach(e=>t(e))}(),function(){function t(e){e.getValue=function(){return this.value}}HTMLElement.prototype.initauthor=t,document.querySelectorAll(".liked-by").forEach(e=>t(e))}(),function(){function t(e){(e=e||this).addEventListener("click",function(e){var t;e.target.classList.contains("dropdown")?e.target.classList.contains("open")?e.target.classList.contains("open")&&o(e.target):n(e.target):e.target.classList.contains("option")&&(t=e.target.innerHTML,(e=e.target.closest(".dropdown")).querySelector('input[type="hidden"]').value=t,o(e))}),e.openDropdown=n,e.closeDropdown=o,e.getValue=i,e.setValue=a,""!=e.getValue()&&e.setValue()}function n(e){e=e||this,document.querySelectorAll(".dropdown").forEach(e=>{e.classList.contains("open")&&o(e)}),e.classList.add("open"),e.querySelector(".selection").innerHTML=e.querySelector(".placeholder").innerHTML}function o(e){(e=e||this).classList.remove("open");var t=e.querySelector('input[type="hidden"]').value,n=e.querySelector(".placeholder").innerHTML;e.querySelector(".selection").innerHTML=""==t?n:t}function i(){return this.querySelector('input[type="hidden"]').value}function a(t){t=t||this.getValue();var e=this.querySelectorAll(".options .option"),e=(e=Array.prototype.slice.call(e)).find(e=>e.innerHTML==t);e?(e=e.innerHTML,this.querySelector('input[type="hidden"]').value=e,o(this)):this.querySelector('input[type="hidden"]').value=""}document.addEventListener("click",function(e){e.target.closest(".dropdown")||document.querySelectorAll(".dropdown").forEach(e=>{e.classList.contains("open")&&o(e)})}),HTMLElement.prototype.initDropdown=t,document.querySelectorAll(".dropdown").forEach(e=>t(e))}(),function(){function t(e){(e=e||this).classList.contains("switchbutton")&&(e.addEventListener("click",function(e){e.target.classList.contains("switchbutton")&&n(e.target)}),e.toggleSwitchbutton=n,e.getValue=o,e.setValue=i)}function n(e){var t="on",n=((e=e||this).classList.contains("on")?(e.classList.remove("on"),e.isChecked=!1,e.querySelector('input[type="hidden"]').value=0,t="off"):(e.classList.add("on"),e.isChecked=!0,e.querySelector('input[type="hidden"]').value=1),new Event("change"));n.state=t,e.dispatchEvent(n)}function o(){return"1"==this.querySelector('input[type="hidden"]').value}function i(e){e="on"==e||"1"==e||"true"==e||1==e;e?(this.classList.add("on"),this.isChecked=!0,this.querySelector('input[type="hidden"]').value=1):(this.classList.remove("on"),this.isChecked=!1,this.querySelector('input[type="hidden"]').value=0)}HTMLElement.prototype.initSwitchbutton=t,document.querySelectorAll(".switchbutton").forEach(e=>t(e))}(),function(){function t(t){(t=t||this).classList.contains("link-copier")&&(t.container=t.closest(".link-copier-holder"),t.setUrl=n,t.reset=e,t.realLink=t.parentElement.querySelector("a.link-copier-link"),t.addEventListener("click",e=>{e.target.select(),document.execCommand("copy"),t.container.classList.add("copied")}))}function e(e){this.closest(".link-copier-holder").classList.remove("copied")}function n(e){this.value=e,this.realLink&&(this.realLink.href=e)}HTMLElement.prototype.initLinkCopier=t,document.querySelectorAll(".link-copier").forEach(e=>t(e))}(),function(){function t(e){(e=e||this).classList.contains("popup")&&(e.addEventListener("click",function(e){e.target.classList.contains("popup")&&e.target.hide(e)}),e.show=function(e){this.classList.add("open"),document.body.classList.add("popupOpen"),this.querySelectorAll(".file-uploader-holder").forEach(e=>e.enable()),e&&e.preventDefault()}.bind(e),e.hide=function(e){this.classList.remove("open"),document.body.classList.remove("popupOpen"),this.onHide&&this.onHide();this.querySelectorAll(".file-uploader-holder").forEach(e=>e.disable()),this.querySelector(".content").style="",this.dispatchEvent(n),e&&e.preventDefault()}.bind(e))}const n=new Event("close-popup");HTMLElement.prototype.initPopup=t,document.querySelectorAll(".popup").forEach(e=>t(e))}(),function(){var o=document.querySelector(".toast");function i(e,t,n){t?o.querySelector("svg").outerHTML=t:o.querySelector("svg").style.display="none",n?(o.querySelector(".undo").classList.remove("hidden"),o.querySelector(".undo").onclick=function(e){e.preventDefault(),o.classList.remove("shown"),n()}):o.querySelector(".undo").classList.add("hidden"),o.querySelector("p").innerHTML=e,o.classList.add("shown"),setTimeout(()=>{o.classList.remove("shown")},4e3+(n?4e3:0))}o.show=function(t,e,n){e?ajax("/svg/"+e,e=>{e.error?i(t,null,n):i(t,e.html,n)}):i(t,null,n)},o.addEventListener("click",()=>{})}();var mobileMenu,installEvent,loginPopup,signupPopup,mainMenu,cookieDate,toast=document.querySelector(".toast"),installAppPopup=(isInStandaloneMode||((mobileMenu={container:document.querySelector("#mobile-menu"),wrapper:document.querySelector("#mobile-menu .wrapper"),button:document.querySelector("header.top .mobile-menu-toggle"),resizeTimer:null,menuOpen:!1,adjustMobileMenu:function(){var e=document.querySelectorAll("#main-menu a"),t=document.querySelector("#main-menu").offsetTop,n=this.wrapper,o=(mobileMenu.button.classList.remove("hidden"),n.innerHTML="",0);Array.from(e).forEach(function(e){20<e.offsetTop-t&&(e=e.cloneNode(!0),n.appendChild(e),o++)}),0==o?mobileMenu.button.classList.add("hidden"):mobileMenu.button.classList.remove("hidden")}}).adjustMobileMenu(),window.addEventListener("resize",function(e){clearTimeout(mobileMenu.resizeTimer),mobileMenu.resizeTimer=setTimeout(function(){mobileMenu.adjustMobileMenu()},50)}),mobileMenu.toggleMenu=function(){var e=document.getElementById("mobile-menu-button-close-icon"),t=document.getElementById("mobile-menu-button-open-icon");mobileMenu.menuOpen?(mobileMenu.container.style.maxHeight=mobileMenu.container.offsetHeight+"px",mobileMenu.container.style.transition="max-height 500ms, opacity 0.5s",setTimeout(function(){mobileMenu.container.style.maxHeight="0px",t.style.display="inline",e.style.display="none",mobileMenu.menuOpen=!1},10)):(mobileMenu.container.style.transition="max-height 1s ease-in, opacity 0.5s",mobileMenu.container.style.maxHeight="100vh",t.style.display="none",e.style.display="inline",mobileMenu.menuOpen=!0)}),document.querySelector(".popup.install-app")),promptHolder=document.querySelector(".prompt-holder");function activateLikeButtons(t){var e=(t=t||document).querySelectorAll("button.like-button"),e=(e.forEach(e=>{e.classList.contains("empty")||e.activated||(e.activated=!0,e.addEventListener("click",e=>{var t=e.target,n=e.target.parentElement,e={content:t.dataset.content,type:t.dataset.type};if(updateMode)return toast.show("Lospec is currently in read-only mode.","warning");"true"==t.dataset.login?document.querySelector(".popup.sign-up").show():n.classList.contains("liked")?(n.classList.remove("liked"),ajax("/likes/unlike",e,e=>{e.success?ga("send","event","unlike",t.dataset.type,window.location.pathname):(n.classList.add("liked"),toast.show("There was a problem removing your like.","warning"))})):(n.classList.add("liked"),ajax("/likes/like",e,e=>{e.success?ga("send","event","like",t.dataset.type,window.location.pathname):(n.classList.remove("liked"),toast.show("There was a problem saving your like.","warning"))}))}))}),t.querySelectorAll("a.show-likes-list")),n=t.querySelector(".popup.likes-list"),o=t.querySelector(".user-likes-list");e.forEach(e=>{e.classList.contains("empty")||e.activated||(e.activated=!0,e.addEventListener("click",e=>{e.preventDefault();e=e.target.parentElement.querySelector("button.like-button");o.innerHTML=t.getElementById("loading-likes").innerHTML,n.show(),ga("send","event","showed likes list popup",t.referrer),fetch("/likes/list?"+new URLSearchParams({type:e.dataset.type,content:e.dataset.content})).then(async function(e){e.ok?204===e.status?o.innerHTML=t.getElementById("no-likes-found").innerHTML:(e=await e.json(),o.innerHTML=e.html):o.innerHTML=t.getElementById("failed-loading-likes").innerHTML,ga("send","event","updated likes list popup",t.referrer)})}))})}document.querySelector(".show-app-info-button").addEventListener("click",e=>{e.preventDefault(),installAppPopup.show(),ga("send","event","showed pwa popup",document.referrer)}),window.addEventListener("beforeinstallprompt",e=>{installEvent=e,promptHolder.classList.add("installable"),installEvent.userChoice.then(e=>{"accepted"===e.outcome&&(ga("send","event","installed pwa",document.referrer),location.reload())})}),document.querySelector(".app-install-button").addEventListener("click",e=>{installEvent.prompt()}),function(){var n,o,i,a;function t(e,t){if(document.querySelectorAll(".feedback-container .feedback .selected").forEach(e=>e.classList.remove("selected")),e.classList.add("selected"),e.parentElement.parentElement.querySelector(".add-feedback-comment textarea").placeholder=t,e.parentElement.parentElement.querySelector(".add-feedback-comment").classList.remove("hidden"),e.classList.contains("thumbs-up"))n="up";else{if(!e.classList.contains("thumbs-down"))return;n="down"}t={vote:n};o&&(t.voteId=o),ajax("/feedback",t,e=>{e.success&&(o=e.vote)})}document.querySelector(".feedback-container")&&(n="unspecified",i=document.querySelector(".feedback-container .feedback .add-feedback-comment div svg"),a=document.querySelector(".feedback-container .feedback .add-feedback-comment div div"),document.querySelector(".feedback-container .feedback .thumbs-up").addEventListener("click",e=>{t(e.target,"Do you have an additional feedback?")}),document.querySelector(".feedback-container .feedback .thumbs-down").addEventListener("click",e=>{t(e.target,"How can we improve this page?")}),document.querySelector(".feedback-container .feedback .add-feedback-comment button").addEventListener("click",e=>{var t=document.querySelector(".feedback-container .feedback .add-feedback-comment textarea").value;""!=t&&(i.style.display="inline-block",a.display="none",ajax("/feedback",{vote:n,voteId:o,feedback:t},e=>{i.style.display="none",e.success?(o=e.vote,a.innerHTML="Your feedback has been recieved!"):a.innerHTML="There was a problem submitting feedback.",a.style.display="inline-block"}),e.preventDefault())}),document.querySelector(".feedback-container .tip-box .show-more").addEventListener("click",e=>{e.preventDefault(),document.querySelector(".feedback-container .tip-box").classList.add("show-hidden")}))}(),document.querySelector("#user-bar .link-button.login")?(loginPopup=document.querySelector(".popup.login"),signupPopup=document.querySelector(".popup.sign-up"),document.querySelector("#user-bar .link-button.login").addEventListener("click",e=>{loginPopup.show(e)}),document.querySelector("#user-bar .link-button.sign-up").addEventListener("click",e=>{signupPopup.show(e)}),loginPopup.querySelector(".switch-to-signup").addEventListener("click",e=>{loginPopup.hide(e),signupPopup.show(e)}),signupPopup.querySelector(".switch-to-login").addEventListener("click",e=>{loginPopup.show(e),signupPopup.hide(e)}),Array.from(document.querySelectorAll(".open-login-form")).forEach(e=>{e.addEventListener("click",e=>{loginPopup.show(e),e.preventDefault()})}),Array.from(document.querySelectorAll(".open-sign-up-form")).forEach(e=>{e.addEventListener("click",e=>{signupPopup.show(e),e.preventDefault()})})):updateMode||(document.querySelector("#user-bar .profile-menu .user-button").addEventListener("click",e=>{e.target.parentElement.classList.toggle("open"),e.preventDefault()}),document.querySelector("#user-bar .profile-menu .logout-button").addEventListener("click",e=>{})),document.body.addEventListener("devicePixelRatio",e=>{var t,n=1+window.devicePixelRatio%1;1!=n&&((t=document.createElement("style")).innerHTML=`
	img.emoji.p12 {width: ${24/n}px}
	img.emoji.p16 {width: ${32/n}px}
	img.emoji.p24 {width: ${24/n}px}
	img.emoji.p32 {width: ${32/n}px}
	`,document.head.appendChild(t))}),function(){var t,n,o,i=!1,a=0,s=document.querySelector("#user-bar .notifications"),r=document.querySelector("#user-bar .notifications .unread-number"),c=document.querySelector("#switchbutton-enable-push");function l(e){e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:function(e){var t="=".repeat((4-e.length%4)%4),e=(e+t).replace(/-/g,"+").replace(/_/g,"/"),n=window.atob(e),o=new Uint8Array(n.length);for(let e=0;e<n.length;++e)o[e]=n.charCodeAt(e);return o}("BDI1FRJJWq0lH-sFDeC54dedZlbxnPAmYIL4UoS9FSIrt21fvymYItofh0Lh7XIGCeyJ6GviNeiDsFhrJnV21uk")}).then(e=>{fetch("/notifications/subscribe",{method:"POST",body:JSON.stringify(e),headers:{"content-type":"application/json"}}),ga("send","event","push notifications enabled")})}function d(){s.classList.add("open");var e={};t&&(e.latestNotification=t),n.scrollTop=0,ajax("/notifications/load",e,e=>{!e.upToDate||t||i||(i=!0,o.innerHTML="You don't have any notifications yet."),e.success&&(n.insertAdjacentHTML("afterbegin",e.html),t||(i=!e.moreToLoad)&&(o.innerHTML="End of notifications"),t=e.latestNotification),(e.upToDate||e.success)&&r.classList.add("up-to-date")})}function u(){s.classList.remove("open"),n.querySelectorAll(".message-link.new").forEach(e=>{e.classList.remove("new")})}s&&(n=s.querySelector(".notification-list ul"),o=n.querySelector(".end"),s.init=function(t){"PushManager"in window&&(c.addEventListener("change",e=>{"on"==e.state?"granted"==Notification.permission?(l(t),ga("send","event","push enabled","already had permission")):"denied"==Notification.permission?(c.setValue("off"),toast.show("Push notifications for Lospec are blocked. Re&#8209;enable it in your browser settings.","warning"),ga("send","event","push blocked","already blocked")):new Promise(function(t,e){var n=Notification.requestPermission(function(e){t(e)});n&&n.then(t,e)}).then(function(e){if("granted"!==e)throw new Error("We weren't granted permission.")}).then(function(e){l(t),ga("send","event","push enabled","user accepted")}).catch(e=>{c.setValue("off"),toast.show("Permission to use push notifications was denied.","warning"),ga("send","event","push blocked","user denied")}):"off"==e.state&&t.pushManager.getSubscription().then(function(e){e.unsubscribe().then(function(e){toast.show("Push notifications have been disabled.","check"),ga("send","event","push disabled","user turned off"),ga("send","event","push notifications disabled")}).catch(function(e){toast.show("Failed to disable push notifications.","warning")})})}),"granted"==Notification.permission&&t.pushManager.getSubscription().then(function(e){e&&c.setValue("on")}),new BroadcastChannel("notifications").onmessage=e=>{var t=s.classList.contains("open");e.data.unseenNotifications&&(n.scrollTop=0,t?d():(r.innerHTML=e.data.unseenNotifications,r.classList.remove("up-to-date")))})},s.addEventListener("click",e=>{e.target==s&&(s.classList.contains("open")?u:d)()}),n.addEventListener("scroll",e=>{i||n.scrollTop==n.scrollHeight-n.offsetHeight&&(o.innerHTML="Loading...",ajax("/notifications/load",{page:++a},e=>{e.upToDate||!1===e.moreToLoad?(o.innerHTML="End of notifications",i=!0):o.innerHTML="&nbsp;",e.success&&(n.insertAdjacentHTML("beforeend",e.html),o.parentElement.appendChild(o),t||(i=!e.moreToLoad)&&(n.querySelector(".end").innerHTML="End of notifications"),t=e.latestNotification)}))}),document.addEventListener("click",e=>{s.classList.contains("open")&&e.target!=s&&e.target.closest(".notifications")!==s&&u()}))}(),"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("message",e=>{e.data.jumpToAnchor&&("loading"==document.readyState?document.addEventListener("readystatechange",e=>{"loading"!==document.readyState&&(window.location.hash=e.data.jumpToAnchor)}):window.location.hash=e.data.jumpToAnchor)}),window.addEventListener("load",()=>{!0!==seenLatestUpdate&&ajax("/articles/latest-update",e=>{"string"==typeof e&&e.includes("popup update")&&(document.body.insertAdjacentHTML("beforeend",e),(e=document.querySelector(".popup.update")).initPopup(),activateLikeButtons(e),document.querySelector(".popup.update .footer-bar button.continue").addEventListener("click",e=>{document.querySelector(".popup.update").hide()}),document.querySelector(".popup.update").addEventListener("close-popup",e=>{ajax("/articles/latest-update/mark-seen",e=>{})}),e.show(),ga("send","event","article popup",document.querySelector(".popup.update .content > h1 a").pathname))})}),HTMLElement.prototype.initLikeButton=function(e){this.parentElement.classList.remove("empty"),e.liked&&this.parentElement.classList.add("liked"),this.parentElement.classList.remove("empty")},activateLikeButtons(),"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/service-worker.js").then(e=>{var t=document.querySelector("#user-bar .notifications");t&&t.init(e)})}),1!=window.devicePixelRatio&&document.body.dispatchEvent(new CustomEvent("devicePixelRatio"));const globalClickHandlers={"outbound-link":e=>ga("send","event","Click Link Outbound",e.href,e.innerText),"outbound-social":e=>ga("send","event","Click Link Social",e.dataset.socialsite,window.location.pathname),"outbound-patreon":e=>ga("send","event","Click Link Patreon",e.dataset.loc,window.location.pathname),"promo-box":e=>ga("send","event","Click Promo",e.href,window.location.pathname),"patreon-popup-link":async(e,t)=>{t.preventDefault(),$(".popup.patreon").patreonPopupLoaded||(t=await fetch("/patreon/popup"),$(".popup.patreon .content").innerHTML=await t.text()),$(".popup.patreon").show(),ga("send","event","Opened patreon popup",window.location.pathname)},"feedback-popup-link":async(e,t)=>{t.preventDefault(),$(".popup.feedback").patreonPopupLoaded||(t=await fetch("/feedback/popup"),$(".popup.feedback .content").innerHTML=await t.text()),$(".popup.patreon").show(),ga("send","event","Opened patreon popup",window.location.pathname)}};document.addEventListener("click",function(t){if("path"==t.target.tagName)var n=t.target.parentElement.parentElement;else if("svg"==t.target.tagName)n=t.target.parentElement;else{if("A"!=t.target.tagName)return;n=t.target}var e;Object.keys(globalClickHandlers).forEach(e=>{n.classList.contains(e)&&globalClickHandlers[e](n,t)}),n.dataset.clickevent&&(e=n.dataset.clickevent.split("|"),ga("send","event",e[0],e[1],e[2]))}),isInStandaloneMode&&(mainMenu=document.querySelector("#main-menu"),(cookieDate=new Date).setFullYear(3e3),cookieDate=cookieDate.toUTCString(),document.querySelector("#user-bar .standalone-menu .open-menu").addEventListener("click",e=>{mainMenu.classList.toggle("open"),document.querySelector("html").classList.toggle("standaloneMenuOpen");var t=mainMenu.classList.contains("open");"none"!==window.getComputedStyle(mainMenu).boxShadow&&(t=!1),document.cookie="standaloneMenuOpen="+t+"; expires="+cookieDate+"; path=/"}),document.querySelector("#main-menu .standalone-controls button.navigate-back").addEventListener("click",e=>{window.history.back()}),document.querySelector("#main-menu .standalone-controls button.navigate-back").addEventListener("click",e=>{window.history.forward()}),document.querySelector("#main-menu .standalone-controls button.navigate-refresh").addEventListener("click",e=>{location.reload()}),document.querySelector("#main-menu .standalone-controls button.navigate-share").addEventListener("click",e=>{document.querySelector(".popup.share-generic").show(e)}),document.addEventListener("click",function(e){!mainMenu.classList.contains("open")||e.target.closest("#main-menu")||e.target.closest("button.open-menu")||"none"!=window.getComputedStyle(mainMenu).boxShadow&&(mainMenu.classList.remove("open"),document.querySelector("html").classList.remove("standaloneMenuOpen"),document.cookie="standaloneMenuOpen=false; expires="+cookieDate+"; path=/")})),window.addEventListener("beforeunload",function(e){document.getElementById("page-loading-spinner").classList.add("visible")}),document.querySelector(".site-footer .patreon-counter .tip-box .show-more").addEventListener("click",e=>{e.preventDefault(),document.querySelector(".site-footer .patreon-counter .tip-box").classList.add("show-hidden")});